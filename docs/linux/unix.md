---
layout: default
title: unix
has_children: false
permalink: /docs/kb/linux/unix
parent: linux
grand_parent: kb
has_toc: true
---
Общие заметки про UNIX, Linux
<details close markdown="block">
  <summary>
    Содержание
  </summary>
  {: .text-delta }
1. TOC
{:toc}
</details>

# auditd
## Chapitre 12. Auditing the system
<https://docs.redhat.com/fr/documentation/red_hat_enterprise_linux/9/html/security_hardening/auditing-the-system_security-hardening>
## Linux audit userspace repository
<https://github.com/linux-audit/audit-userspace>

# /etc/skel

:robot:

`/etc/skel` — это каталог в UNIX-подобных операционных системах, который используется для создания начальных (скелетных) файлов в домашнем каталоге нового пользователя. Когда создается новый пользователь, файлы и каталоги из `/etc/skel` копируются в его домашний каталог.

### Основные характеристики `/etc/skel`:

1. **Предназначение**:
   - Содержит шаблоны файлов, которые должны быть скопированы в домашний каталог каждого нового пользователя.
   - Обычно включает файлы конфигурации, такие как `.bashrc`, `.profile`, `.bash_profile`, `.bash_logout` и другие.

2. **Содержание**:
   - Файлы и каталоги, которые автоматически создаются для каждого нового пользователя.
   - Могут включать пользовательские настройки, скрипты и другие файлы, которые должны быть доступны пользователю с самого начала.

3. **Использование**:
   - Администраторы могут настраивать содержимое `/etc/skel` для всех новых пользователей, добавляя или изменяя файлы по мере необходимости.
   - Например, можно добавить общие настройки среды, скрипты начальной настройки, шаблоны документов и т.д.

### Пример содержимого `/etc/skel`:

```bash
/etc/skel
|-- .bash_logout
|-- .bashrc
|-- .profile
|-- .config/
|-- Documents/
|-- Downloads/
```

### Пример использования:

1. **Создание нового пользователя**:
   При создании нового пользователя с помощью команды `useradd` или `adduser`, файлы из `/etc/skel` копируются в домашний каталог нового пользователя.

   ```bash
   sudo useradd -m newuser
   ```

   В результате в домашнем каталоге `/home/newuser` появятся файлы и каталоги из `/etc/skel`.

2. **Настройка `/etc/skel`**:
   Администратор может добавить или изменить файлы в `/etc/skel` по своему усмотрению. Например:

   ```bash
   sudo cp /path/to/custom/.bashrc /etc/skel/.bashrc
   sudo mkdir /etc/skel/Templates
   sudo cp /path/to/template.doc /etc/skel/Templates/
   ```

Таким образом, `/etc/skel` предоставляет централизованный способ настройки начальной среды новых пользователей, что упрощает управление и стандартизацию пользовательских настроек в системе.

# Добавление сервтификата в Debian
/usr/local/share/ca-certificates/ Directory of local CA certificates (with .crt extension).
```
sudo cp trusted_root_ca.crt /usr/local/share/ca-certificates/
```
update-ca-certificates is a program that updates the directory /etc/ssl/certs to hold SSL certificates and generates ca-certificates.crt, a concatenated single-file list of certificates.
```
sudo update-ca-certificates -v
```

В Red Hat Linux (и других дистрибутивах, основанных на Red Hat, таких как CentOS и Fedora), управление пользователями и группами осуществляется с помощью различных команд. Вот основные команды, которые могут пригодиться для управления пользователями:

# Управление пользователями
## 1. **Создание пользователя**
   - `useradd <имя_пользователя>`  
     Создает нового пользователя в системе.

   - Пример: `useradd john`

   - Параметры:
     - `-m`: Создать домашний каталог пользователя.
     - `-d <путь_к_каталогу>`: Указать путь к домашнему каталогу.
     - `-s <shell>`: Указать оболочку (например, `/bin/bash`).
     - `-g <группа>`: Указать основную группу пользователя.
     - `-G <группы>`: Указать дополнительные группы.

## 2. **Задание пароля пользователя**
   - `passwd <имя_пользователя>`  
     Устанавливает или изменяет пароль пользователя.

   - Пример: `passwd john`

## 3. **Изменение информации о пользователе**
   - `usermod <опции> <имя_пользователя>`  
     Изменяет существующего пользователя.

   - Пример: `usermod -aG wheel john`  
     Добавляет пользователя "john" в группу "wheel".

   - Параметры:
     - `-aG <группа>`: Добавить пользователя в группу (без удаления из других групп).
     - `-l <новое_имя>`: Переименовать пользователя.
     - `-d <новый_домашний_каталог>`: Изменить домашний каталог.

## 4. **Удаление пользователя**
   - `userdel <имя_пользователя>`  
     Удаляет пользователя из системы.

   - Пример: `userdel john`

   - Параметры:
     - `-r`: Удалить домашний каталог и почту пользователя.

## 5. **Просмотр информации о пользователе**
   - `id <имя_пользователя>`  
     Показывает UID, GID и группы, к которым принадлежит пользователь.

   - Пример: `id john`

   - `finger <имя_пользователя>`  
     Выводит информацию о пользователе, такую как его полное имя, время входа, местонахождение и т.д.

   - Пример: `finger john`

## 6. **Управление группами**
   - `groupadd <имя_группы>`  
     Создает новую группу.

   - Пример: `groupadd developers`

   - `groupdel <имя_группы>`  
     Удаляет группу.

   - Пример: `groupdel developers`

   - `groupmod <опции> <имя_группы>`  
     Изменяет параметры существующей группы.

   - Пример: `groupmod -n devs developers`  
     Переименовывает группу "developers" в "devs".
     
   - Пример: `gpasswd -d user group`  
     Удалить пользователя "user" из группы "group".

## 7. **Просмотр списка пользователей и групп**
   - `cat /etc/passwd`  
     Отображает список всех пользователей системы.

   - `cat /etc/group`  
     Отображает список всех групп в системе.

## 8. **Добавление и удаление пользователей из групп**
   - `gpasswd -a <имя_пользователя> <имя_группы>`  
     Добавляет пользователя в группу.

   - Пример: `gpasswd -a john developers`

   - `gpasswd -d <имя_пользователя> <имя_группы>`  
     Удаляет пользователя из группы.

   - Пример: `gpasswd -d john developers`

## 9. **Блокировка и разблокировка пользователя**
   - `usermod -L <имя_пользователя>`  
     Блокирует учетную запись пользователя.

   - Пример: `usermod -L john`

   - `usermod -U <имя_пользователя>`  
     Разблокирует учетную запись пользователя.

   - Пример: `usermod -U john`

# Запрос на выпуск сертификата сервера
## создать конфигурацию запроса на сертификат сервера
```bash
nano server_csr.cnf
```
```bash
[ req ]
default_bits       = 4096
default_md         = sha256
prompt             = no
default_keyfile    = SERVER.key
distinguished_name = req_distinguished_name
req_extensions     = req_ext

[ req_distinguished_name ]
C  = RU
ST = Moscow
CN = SERVER

[ req_ext ]
subjectAltName = @alt_names

[ alt_names ]
DNS.1 = SERVER
#DNS.2 =
#IP.1 = 
```
## генерация закрытого ключа
```bash
openssl genpkey -algorithm RSA -out SERVER.key -pkeyopt rsa_keygen_bits:4096
```
## генерация запроса на сертификат
```bash
openssl req -new -key SERVER.key -out SERVER.csr -config server_csr.cnf
```

## проверка запроса на выпуск сертификата
```bash
openssl req -in SERVER.csr -noout -text
```

# systemctl daemon-reload
Команда `systemctl daemon-reload` используется для того, чтобы перезагрузить конфигурацию `systemd`-демона. Она выполняется в следующих случаях:

1. **Обновление конфигурационных файлов**: Если вы внесли изменения в файлы юнитов (`.service`, `.socket`, `.timer` и т.д.), расположенные в каталогах `/etc/systemd/system/` или `/usr/lib/systemd/system/`, `systemd` не распознает эти изменения автоматически. Команда `systemctl daemon-reload` перезагружает конфигурацию, чтобы система учитывала внесенные изменения.

2. **Добавление новых юнитов**: Если вы добавили новые юниты или удалили старые, `systemd` также должен обновить свою конфигурацию. Это требуется, чтобы новые юниты были зарегистрированы и могли быть использованы.

3. **После выполнения обновлений**: В некоторых случаях, после обновления пакетов, связанных с `systemd`, рекомендуется выполнить `daemon-reload`, чтобы система использовала новые конфигурационные параметры.

Важно отметить, что перезагрузка конфигурации с помощью `systemctl daemon-reload` не прерывает и не перезапускает текущие службы. Это просто заставляет `systemd` заново считать конфигурационные файлы и обновить свою внутреннюю базу данных юнитов.
